

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hyper-V &mdash; jwtest 1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/my_theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="jwtest 1 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.svg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../provisioning/provisioning.html">Provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administration/administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/monitoring.html">Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logs/logging.html">Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backups/backups.html">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations/operations.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration_guides.html">Integration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/faqs.html">FAQ’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/release_notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">jwtest</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Hyper-V</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/integration_guides/hyperv.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hyper-v">
<h1>Hyper-V<a class="headerlink" href="#hyper-v" title="Permalink to this headline">¶</a></h1>
<p>Hyper-V is the virtualized server computing environment introduced by Microsoft. Hyper-V is consumed by |morpheus| as a private cloud offering and is a common hypervisor technology in data centers. |morpheus| provides and avenue to aggregate Hyper-V resources together to allow efficient and seamless deployment of applications as a virtual machine (VM) or Docker host in the world of Hyper-V.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Virtual Machine Provisioning</li>
<li>Containers</li>
<li>Backups / Snapshots</li>
<li>Resources Groups</li>
<li>Migrations</li>
<li>Auto Scaling</li>
<li>Load Balancing</li>
<li>Remote Console</li>
<li>Periodic Synchronization</li>
<li>Veeam Integration</li>
<li>Lifecycle Management and Resize</li>
<li>Unique Kerberos Authentication</li>
</ul>
<p>|morpheus| can provide a single pane of glass and self-service portal for managing instances scattered across both Hyper-V and public cloud offerings like Azure.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>To get started this a few prerequisites must first be met. The Hyper-V host most be installed with its firewall enabled and it can either be joined to a domain or standalone. The Hyper-V host must also have the external network of Hyper-V configured and it can share this network with the management operating system. This document covers Hyper-V 2008 and Hyper-V 2012.</p>
<p>A user account that is part of the local administrators group on the Hyper-V host is also required.</p>
<p>=== Understand WinRM</p>
<p>|morpheus| uses WinRM to communicate to the Hyper-V host for deployment of the |morpheus| agent. The |morpheus| agent allows for the host dashboard to be populated with information in the form of graphs that cover CPU, Network, Storage, and memory consumption. Furthermore, this agent provides logging and monitoring capabilities.</p>
<p>If Windows Remote Management (WinRM) is not installed and configured, WinRM scripts do not run and the Winrm command-line tool cannot perform data operations or allow for the |morpheus| agent to be installed. WinRM uses Http port 5985 or Https port 5986 for communications.</p>
<p>To better understand all of the default settings of WinRM please refer to the below Microsoft link:</p>
<p><a class="reference external" href="https://msdn.microsoft.com/en-us/library/aa384372(v=vs.85).aspx">https://msdn.microsoft.com/en-us/library/aa384372(v=vs.85).aspx</a></p>
<p>==== Native Authentication</p>
<p>To configure WinRM with default settings (WINRM_NATIVE)</p>
<p>Type the following command at a command prompt:
[source,shell]</p>
<blockquote>
<div>$ winrm quickconfig</div></blockquote>
<p>If you are not running under the local computer Administrator account, you must either select Run as Administrator from the Start menu or use the <cite>Runas</cite> command at a command prompt.</p>
<p>When the tool displays Make these changes <cite>[y/n]?</cite>, type <cite>y</cite>.</p>
<p>If configuration is successful, the following output is displayed:
[source,shell]
—-
$ WinRM has been updated for remote management.
$ WinRM service type changed to delayed auto start.
$ WinRM service started.
$ Created a WinRM listener on <a class="reference external" href="HTTP://*">HTTP://*</a> to accept WS-Man requests to any IP on this
machine.
—-</p>
<p>Keep the default settings for client and server components of WinRM, or customize them. By default Kerberos is enabled and if domain authentication is not being used we want to disable that. Issue the below commands to setup basic authentication:
[source,shell]
—-
$ winrm set winrm/config/service/Auth &#64;{Basic=”true”}
$ winrm set winrm/config/service &#64;{AllowUnencrypted=”true”}
$ winrm set winrm/config/service/Auth &#64;{Kerberos=”false”}
—-</p>
<p>=== Domain Authentication</p>
<p>To configure WinRM with Domain Authentication (WINRM_INTERNAL)</p>
<p>Type the following command at a command prompt</p>
<blockquote>
<div>$ winrm quickconfig</div></blockquote>
<p>If you are not running under the local computer Administrator account, you must either select Run as Administrator from the Start menu or use the Runas command at a command prompt.</p>
<p>When the tool displays Make these changes [y/n]?, type y.</p>
<p>If configuration is successful, the following output is displayed:
[source,shell]
—-
$ WinRM has been updated for remote management.
$ WinRM service type changed to delayed auto start.
$ WinRM service started.
$ Created a WinRM listener on <a class="reference external" href="HTTP://*">HTTP://*</a> to accept WS-Man requests to any IP on this
machine.
—-</p>
<p>Keep the default settings for client and server components of WinRM, or customize them. Issue the below commands to setup domain authentication:
[source,shell]
—-</p>
<blockquote>
<div>$ winrm set winrm/config/service/Auth &#64;{Basic=”true”}
$ winrm set winrm/config/service &#64;{AllowUnencrypted=”false”}
$ winrm set winrm/config/service/Auth &#64;{Kerberos=”true”}</div></blockquote>
<p>On the |morpheus| appliance the krb5-user package must be installed. For Ubuntu the command is as follows:
.. code-block:: bash</p>
<blockquote>
<div>$ sudo apt-get install krb5-user</div></blockquote>
<p>Create a file in /etc called krb5.conf and replace the domain name with the name of the domain to be used. In this case we used |morpheus| .com as the domain.
.. code-block:: bash</p>
<blockquote>
<div><dl class="docutils">
<dt>[libdefaults]</dt>
<dd><dl class="first docutils">
<dt>default_realm = |morpheus| .COM</dt>
<dd>dns_lookup_kdc = true
verify_ap_req_nofail = false</dd>
</dl>
<p class="last">default_tgs_enctypes = rc4-hmac
default_tkt_enctypes = rc4-hmac</p>
</dd>
<dt>[realms]</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>|morpheus| .COM = {</dt>
<dd>kdc = win-ad.|morpheus| .COM:88
admin_server = win-ad.|morpheus| .COM:749</dd>
</dl>
</div></blockquote>
<p class="last">}</p>
</dd>
<dt>[domain_realm]</dt>
<dd><dl class="first last docutils">
<dt>.|morpheus| .COM = |morpheus| .COM</dt>
<dd>|morpheus| .COM = |morpheus| .COM</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>.. code-block:: bash</dt>
<dd><dl class="first last docutils">
<dt>[login]</dt>
<dd>krb4_convert = true
krb4_get_tickets = false</dd>
</dl>
</dd>
</dl>
<p>After creation of the krb5.conf a keytab file is also required. See below on instructions on how to create a keytab file.
<a class="reference external" href="http://www.itadmintools.com/2011/07/creating-kerberos-keytab-files.html">http://www.itadmintools.com/2011/07/creating-kerberos-keytab-files.html</a></p>
<p>=== Adding Hyper-V as a Private Cloud</p>
<p>The Hyper-V host is prepared for |morpheus| to communicated with it via WinRM so the Hyper-V private cloud is ready to be configured. Create a group and then create a |morpheus| cloud for Hyper-V. Populated the information as show in Figure 1: specific for the environment being configured.</p>
<p>//HV1</p>
<p>NOTE: The working path, vm path, and disk path should be created on the Hyper-V host by the Hyper-V administrator. If these paths are not created they will need to be setup and the Hyper-V settings will need to adjusted to reference them.</p>
<p>//HV2</p>
<p>=== Service Plans</p>
<p>A default set of Service Plans are created in |morpheus| for the VMware provisioning engine. These Service Plans can be considered akin to AWS Flavors or Openstack Flavors. They provide a means to set predefined tiers on memory, storage, cores, and cpu. Price tables can also be applied to these so estimated cost per virtual machine can be tracked as well as pricing for customers. By default, these options are fixed sizes but can be configured for dynamic sizing. A service plan can be configured to allow a custom user entry for memory, storage, or cpu. To configure this, simply edit an existing Service Plan tied to Hyper-V or create a new one. These all can be easily managed from the Admin | Service Plans &amp; Pricing section.</p>
<p>//HV3</p>
<p>=== Docker</p>
<p>So far this document has covered how to add the Hyper-V cloud integration and has enabled users the ability to provision virtual machine based instances via the Add Instance catalog in Provisioning. Another great feature provided by |morpheus| out of the box is the ability to use Docker containers and even support multiple containers per Docker host. To do this a Docker Host must first be provisioned into Hyper-V (multiple are needed when dealing with horizontal scaling scenarios).</p>
<p>To provision a Docker Host simply navigate to the Cloud detail page or Infrastructure | Hosts section. From there click the + Container Host button to add a Hyper-V Docker Host. |morpheus| views a Docker host just like any other Hypervisor with the caveat being that it is used for running containerized images instead of virtualized ones. Once a Docker Host is successfully provisioned a green checkmark will appear to the right of the host marking it as available for use. In the event of a failure click into the relevant host that failed and an error explaining the failure will be displayed in red at the top.</p>
<p>Some common error scenarios include network connectivity. For a Docker Host to function properly, it must be able to resolve the |morpheus| appliance url which can be configured in Admin | Settings. If it is unable to resolve and negotiate with the appliance than the agent installation will fail and provisioning instructions will not be able to be issued to the host.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, jw.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>