Okta SAML SSO Guide
^^^^^^^^^^^^^^^^^^^
  
    Adding SAML integration in |morpheus|

    #. Navigate to |AdmTen|
    #. Select the Tenant to add the Identity Source Integration
    #. Select :guilabel:`IDENTITY SOURCES`
    #. Select :guilabel:`+ IDENTITY SOURCE`
    #. Enter the following **minimal** settings to generate the SSO details needed in |morpheus|:
     
       TYPE
         SAML SSO
       NAME
         Name of the Identity Source Integration in |morpheus|
       LOGIN REDIRECT URL
         Enter any value in this location, **it does not need to be correct**

         .. IMPORTANT::
           We will return later and enter the correct information, once it is generated from the SAML Identity Provider (IdP)

    #. Copy the contents of the ``SAML REQUEST`` certificate and save it to a text file.  Include the ``-----BEGIN CERTIFICATE-----`` and ``-----END CERTIFICATE-----``.  This text file will be used later in the IdP configuration
    #. Select :guilabel:`SAVE CHANGES`
    #. After saving the changes, a new Identity Source will appear with an ``ENTITY ID``, ``SP ACS URL``, and the value entered for the ``LOGIN REDIRECT URL``.  These details will be needed when configuring the SAML Identity Provider (IdP)
     
       .. image:: /images/integration_guides/identity_sources/saml_sso/morpheus_saml_minimal_setup.png
         :scale: 50%
  
    #. Navigate and login to the Okta Administration Portal
    #. Navigate to ``Applications > Applications``
    #. Select the ``Create App Inegration`` button
     
       .. image:: /images/integration_guides/identity_sources/okta/create_app_button.png
         :scale: 50%

    #. Choose ``SAML 2.0`` and select the ``Next`` button
    #. In the ``General Settings`` section, provide the ``App name`` then select the ``Next`` button
    #. Select the ``Show Advanced Settings`` under the ``SAML Settings`` section, to be able to see all the settings
    #. In the ``Configure SAML`` section, fill in the fields mentioned below
     
       Single sign-on URL
         This is the ``SP ACS URL`` from the |morpheus| Identity Source
       Audience URI (SP Entity ID)
         This is the ``ENTITY ID`` from the |morpheus| Identity Source
       Name ID format
         Set to **Unspecified**
       Signature Certificate
         Upload the certificate we saved when creating the Identity Source in |morpheus|
       Enable Single Logout
         Checkmark this box to enable the Single Logout URL field.  Example:  https://morpheus.test.local/login
       Single Logout URL
         This is your |morpheus| login URL, so you are redirected back to |morpheus| after logging out
       Attribute Statements (optional)
         .. list-table:: Attribute Statements
           :widths: 25 25 50
           :header-rows: 1

           * - Name
             - Name format
             - Value
           * - mail
             - Unspecified
             - user.email
           * - givenName
             - Unspecified
             - user.firstName
           * - surname
             - Unspecified
             - user.lastName

       Group Attribute Statements (optional)
         .. list-table:: Group Attribute Statements
           :widths: 25 25 50
           :header-rows: 1

           * - Name
             - Name format
             - Filter
           * - groups
             - Unspecified
             - Matches regex .*

       .. image:: /images/integration_guides/identity_sources/okta/application_config1.png
         :scale: 50%

       .. image:: /images/integration_guides/identity_sources/okta/application_config2.png
         :scale: 50%
  
    #. Select the ``Next`` button
    #. Select the ``I'm an Okta customer adding an internal app``
    #. Select ``Finish``
    #. In Okta, on the ``Sign On`` tab, expand the ``More details`` in the ``SAML 2.0`` window

       .. image:: /images/integration_guides/identity_sources/okta/more_details.png
         :scale: 50%

    #. Copy/make note of the ``Sign on URL`` and the ``Sign out URL``, these will be used next in |morpheus|
    #. Assign users to the Okta application 
    #. Assign users to Okta Groups, if mapping the Okta Groups to |morpheus| Roles
    #. Switch back to |morpheus| and edit the Identity Source previously created, to enter the details generated by Okta
       
       #. In the ``LOGIN REDIRECT URL`` field, paste the value from the ``Sign on URL`` in Okta (overwriting the temporary value you initially entered)
       #. In the ``SAML LOGOUT REDIRECT URL`` field, paste the value from the ``Sign out URL`` in Okta
     
       .. image:: /images/integration_guides/identity_sources/okta/morpheus_saml_configuration.png
         :scale: 50%

    #. Under ``ROLE MAPPINGS``
       
       #. Enter ``groups`` for the ``ROLE ATTRIBUTE NAME``
       #. Type the name of a group in Okta to map to a role in |morpheus|

       .. image:: /images/integration_guides/identity_sources/okta/morpheus_saml_roles1.png
         :scale: 50%

       .. image:: /images/integration_guides/identity_sources/okta/morpheus_saml_roles2.png
         :scale: 50%

    #. Select :guilabel:`SAVE CHANGES`
    #. Navigate to your |morpheus| URL
    #. Select the :guilabel:`Okta` button
         
       .. image:: /images/integration_guides/identity_sources/okta/morpheus_login.png
         :scale: 75%

    #. Enter your Okta username and password (or any other authentication required)
         
       .. image:: /images/integration_guides/identity_sources/okta/login.png
         :scale: 50%

    #. At this point, you should be successfully logged in.  Note that your specific permissions will depend on the settings configured in the ``ROLE MAPPINGS`` section when editing the Identity Source in |morpheus|